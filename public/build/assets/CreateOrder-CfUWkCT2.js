import{d as K,c as l,a as u,u as d,h as W,w as f,b as s,e as _,o as n,F as h,r as $,k as P,t as a,g as c,n as H,q as T,v as J,s as Q,m,i as F,p as X}from"./app-Di3RSdmm.js";import{_ as L}from"./index-1LP7WDE3.js";import{_ as U}from"./Input.vue_vue_type_script_setup_true_lang-BhJnLtwg.js";import{_ as M}from"./Label.vue_vue_type_script_setup_true_lang-BLRKX_ny.js";import{_ as Y}from"./Textarea.vue_vue_type_script_setup_true_lang-9OSo_ESF.js";import{S as ee,T as te,c as se,_ as oe}from"./AppLayout.vue_vue_type_script_setup_true_lang-49QvIm49.js";import{S as D}from"./search-CodsYlhY.js";import"./index-BRBC5pXR.js";import"./useForwardExpose-Bohi4aPY.js";import"./VisuallyHidden-BKH4SjpI.js";import"./useForwardPropsEmits-BhcpKy4a.js";import"./index-BsePJUay.js";import"./createLucideIcon-DVVQDtR3.js";const le={class:"flex h-full flex-1 flex-col gap-6 p-6 max-w-3xl"},ne={class:"text-2xl font-bold flex items-center gap-2"},ae={class:"rounded-lg border p-6 space-y-6"},re={class:"space-y-2"},ue={class:"relative"},de={key:0,class:"absolute z-50 mt-1 w-full rounded-md border bg-white shadow-lg"},ie=["onMousedown"],ce={class:"font-medium"},me={class:"text-muted-foreground text-xs"},pe={key:0,class:"text-sm text-destructive"},ve={key:1,class:"rounded-md bg-muted px-4 py-3 text-sm flex items-center justify-between"},fe={class:"font-medium"},_e={class:"text-muted-foreground ml-2"},xe={key:0,class:"ml-2 text-xs text-muted-foreground capitalize"},ye={key:0,class:"space-y-2"},be={key:0,class:"text-sm text-muted-foreground"},he={key:1,class:"space-y-2"},ge=["value"],we={class:"text-sm"},ke={class:"font-medium"},Ce={class:"text-muted-foreground"},Ve={key:0,class:"text-xs text-primary mt-0.5"},qe={class:"space-y-2"},$e={class:"relative"},Me={key:0,class:"absolute z-50 mt-1 w-full rounded-md border bg-white shadow-lg"},Se=["onMousedown"],je={class:"text-muted-foreground text-xs ml-4"},Fe={key:0,class:"text-xs text-muted-foreground"},Ne={key:1,class:"text-sm text-destructive"},Be={key:1,class:"space-y-2"},Pe={class:"flex-1 text-sm font-medium"},Te={class:"text-sm text-muted-foreground w-20 text-right"},Le={class:"flex items-center gap-1"},Ue=["onClick"],De=["onUpdate:modelValue"],ze=["onClick"],Ae={class:"text-sm font-medium w-20 text-right"},Ie=["onClick"],Ee={class:"flex justify-end pt-2 border-t"},Oe={class:"text-sm font-bold"},Re={class:"space-y-2"},Ze={class:"flex gap-3 pt-2"},nt=K({__name:"CreateOrder",props:{customers:{},products:{}},setup(z){const g=z,A=[{title:"Dashboard",href:"/dashboard"},{title:"Bestellingen",href:"/admin/orders"},{title:"Nieuwe bestelling"}],b=m(""),r=m(null),w=m(!1),N=F(()=>{const o=b.value.toLowerCase();return o?g.customers.filter(t=>t.company_name.toLowerCase().includes(o)||t.contact_person.toLowerCase().includes(o)).slice(0,10):g.customers.slice(0,10)}),I=o=>{r.value=o,b.value=o.company_name,w.value=!1;const t=o.delivery_addresses.find(e=>e.is_default)??o.delivery_addresses[0]??null;x.value=t?.id??null,i.value=i.value.map(e=>({...e,unit_price:S(e.product_id)}))},E=()=>{r.value=null,b.value="",x.value=null},x=m(null),k=m(""),C=m(!1),B=F(()=>{const o=k.value.toLowerCase();return o?g.products.filter(t=>t.title.toLowerCase().includes(o)).slice(0,8):[]}),S=o=>{const t=g.products.find(y=>y.id===o);if(!t||!r.value)return 0;let e=parseFloat(t.price);const v=parseFloat(r.value.discount_percentage??"0");return v>0&&(e=e*(1-v/100)),Math.round(e*100)/100},i=m([]),O=o=>{const t=i.value.find(e=>e.product_id===o.id);t?t.quantity+=1:i.value.push({product_id:o.id,product_title:o.title,quantity:1,unit_price:S(o.id)}),k.value="",C.value=!1},R=o=>{i.value.splice(o,1)},Z=F(()=>i.value.reduce((o,t)=>o+t.unit_price*t.quantity,0)),V=o=>new Intl.NumberFormat("nl-NL",{style:"currency",currency:"EUR"}).format(o),j=m(""),p=m({}),q=m(!1),G=()=>{if(p.value={},!r.value){p.value.customer="Selecteer een klant.";return}if(i.value.length===0){p.value.items="Voeg minimaal één product toe.";return}q.value=!0,X.post("/admin/orders",{customer_id:r.value.id,delivery_address_id:x.value,items:i.value.map(o=>({product_id:o.product_id,quantity:o.quantity})),notes:j.value||null},{onError:o=>{p.value=o,q.value=!1},onFinish:()=>{q.value=!1}})};return(o,t)=>(n(),l(h,null,[u(d(W),{title:"Nieuwe bestelling"}),u(oe,{breadcrumbs:A},{default:f(()=>[s("div",le,[s("div",null,[s("h1",ne,[u(d(ee),{class:"h-6 w-6"}),t[8]||(t[8]=_(" Nieuwe bestelling ",-1))]),t[9]||(t[9]=s("p",{class:"text-sm text-muted-foreground"},"Maak een bestelling aan namens een klant",-1))]),s("div",ae,[s("div",re,[u(d(M),null,{default:f(()=>[...t[10]||(t[10]=[_("Klant ",-1),s("span",{class:"text-destructive"},"*",-1)])]),_:1}),s("div",ue,[u(d(D),{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),u(d(U),{modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=e=>b.value=e),placeholder:"Zoek op bedrijfsnaam of contactpersoon...",class:"pl-9",onFocus:t[1]||(t[1]=e=>w.value=!0),onBlur:t[2]||(t[2]=e=>o.setTimeout(()=>w.value=!1,150)),autocomplete:"off"},null,8,["modelValue"]),w.value&&N.value.length>0?(n(),l("div",de,[(n(!0),l(h,null,$(N.value,e=>(n(),l("button",{key:e.id,type:"button",class:"w-full text-left px-4 py-2 text-sm hover:bg-muted flex flex-col",onMousedown:P(v=>I(e),["prevent"])},[s("span",ce,a(e.company_name),1),s("span",me,a(e.contact_person),1)],40,ie))),128))])):c("",!0)]),p.value.customer?(n(),l("p",pe,a(p.value.customer),1)):c("",!0),r.value?(n(),l("div",ve,[s("div",null,[s("span",fe,a(r.value.company_name),1),s("span",_e,a(r.value.contact_person),1),r.value.customer_category?(n(),l("span",xe,"("+a(r.value.customer_category)+")",1)):c("",!0)]),s("button",{type:"button",onClick:E,class:"text-muted-foreground hover:text-foreground text-xs"},"× Wissen")])):c("",!0)]),r.value?(n(),l("div",ye,[u(d(M),null,{default:f(()=>[...t[11]||(t[11]=[_("Afleveradres",-1)])]),_:1}),r.value.delivery_addresses.length===0?(n(),l("div",be," Geen afleveradressen — hoofdadres wordt gebruikt ")):(n(),l("div",he,[(n(!0),l(h,null,$(r.value.delivery_addresses,e=>(n(),l("label",{key:e.id,class:H(["flex items-start gap-3 rounded-md border p-3 cursor-pointer",x.value===e.id?"border-primary bg-primary/5":""])},[T(s("input",{type:"radio",value:e.id,"onUpdate:modelValue":t[3]||(t[3]=v=>x.value=v),class:"mt-0.5"},null,8,ge),[[J,x.value]]),s("div",we,[s("div",ke,a(e.name),1),s("div",Ce,a(e.street_name)+" "+a(e.house_number)+", "+a(e.postal_code)+" "+a(e.city),1),e.is_default?(n(),l("div",Ve,"Standaard")):c("",!0)])],2))),128))]))])):c("",!0),s("div",qe,[u(d(M),null,{default:f(()=>[...t[12]||(t[12]=[_("Producten ",-1),s("span",{class:"text-destructive"},"*",-1)])]),_:1}),s("div",$e,[u(d(D),{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),u(d(U),{modelValue:k.value,"onUpdate:modelValue":t[4]||(t[4]=e=>k.value=e),placeholder:"Zoek product op naam...",class:"pl-9",onFocus:t[5]||(t[5]=e=>C.value=!0),onBlur:t[6]||(t[6]=e=>o.setTimeout(()=>C.value=!1,150)),autocomplete:"off",disabled:!r.value},null,8,["modelValue","disabled"]),C.value&&B.value.length>0?(n(),l("div",Me,[(n(!0),l(h,null,$(B.value,e=>(n(),l("button",{key:e.id,type:"button",class:"w-full text-left px-4 py-2 text-sm hover:bg-muted flex justify-between items-center",onMousedown:P(v=>O(e),["prevent"])},[s("span",null,a(e.title),1),s("span",je,a(V(S(e.id))),1)],40,Se))),128))])):c("",!0)]),r.value?c("",!0):(n(),l("p",Fe,"Selecteer eerst een klant om de juiste prijzen te berekenen.")),p.value.items?(n(),l("p",Ne,a(p.value.items),1)):c("",!0)]),i.value.length>0?(n(),l("div",Be,[(n(!0),l(h,null,$(i.value,(e,v)=>(n(),l("div",{key:e.product_id,class:"flex items-center gap-3 rounded-md border px-3 py-2"},[s("div",Pe,a(e.product_title),1),s("div",Te,a(V(e.unit_price)),1),s("div",Le,[s("button",{type:"button",class:"h-6 w-6 rounded border text-sm flex items-center justify-center hover:bg-muted",onClick:y=>e.quantity=Math.max(1,e.quantity-1)},"−",8,Ue),T(s("input",{type:"number","onUpdate:modelValue":y=>e.quantity=y,min:"1",class:"w-12 text-center text-sm border rounded px-1 py-0.5"},null,8,De),[[Q,e.quantity,void 0,{number:!0}]]),s("button",{type:"button",class:"h-6 w-6 rounded border text-sm flex items-center justify-center hover:bg-muted",onClick:y=>e.quantity+=1},"+",8,ze)]),s("div",Ae,a(V(e.unit_price*e.quantity)),1),s("button",{type:"button",onClick:y=>R(v),class:"text-destructive hover:opacity-70 ml-1"},[u(d(te),{class:"h-4 w-4"})],8,Ie)]))),128)),s("div",Ee,[s("span",Oe,"Totaal: "+a(V(Z.value)),1)])])):c("",!0),s("div",Re,[u(d(M),{for:"notes"},{default:f(()=>[...t[13]||(t[13]=[_("Bestelnotitie",-1)])]),_:1}),u(d(Y),{id:"notes",modelValue:j.value,"onUpdate:modelValue":t[7]||(t[7]=e=>j.value=e),placeholder:"Optionele opmerkingen bij de bestelling...",rows:"3"},null,8,["modelValue"])]),s("div",Ze,[u(d(L),{onClick:G,disabled:q.value},{default:f(()=>[u(d(se),{class:"h-4 w-4 mr-2"}),t[14]||(t[14]=_(" Bestelling aanmaken ",-1))]),_:1},8,["disabled"]),u(d(L),{variant:"outline",as:"a",href:"/admin/orders"},{default:f(()=>[...t[15]||(t[15]=[_("Annuleren",-1)])]),_:1})])])])]),_:1})],64))}});export{nt as default};
