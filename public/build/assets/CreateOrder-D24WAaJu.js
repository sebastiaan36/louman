import{d as W,c as l,a as u,u as d,h as H,w as f,b as s,e as x,o as n,F as h,r as $,k as P,t as a,g as c,n as J,q as T,v as Q,s as X,m,i as F,p as Y}from"./app-K1ubM81i.js";import{S as ee,T as te,c as se,_ as oe}from"./AppLayout.vue_vue_type_script_setup_true_lang-C6auPS4c.js";import{_ as z}from"./index-B2SDlZe3.js";import{_ as L}from"./Input.vue_vue_type_script_setup_true_lang-CTEOnJIr.js";import{_ as j}from"./Label.vue_vue_type_script_setup_true_lang-s0XBMfK1.js";import{_ as le}from"./Textarea.vue_vue_type_script_setup_true_lang-CZy2VnX-.js";import{S as U}from"./search-sx-FHnM6.js";import"./index-BLz36Axw.js";import"./VisuallyHidden-DAJyTYt0.js";import"./useForwardExpose-HTniYRth.js";import"./useForwardPropsEmits-BFXe9T7F.js";import"./index-BsePJUay.js";import"./createLucideIcon-Dv2-4BTx.js";const ne={class:"flex h-full flex-1 flex-col gap-6 p-6 max-w-3xl"},ae={class:"text-2xl font-bold flex items-center gap-2"},re={class:"rounded-lg border p-6 space-y-6"},ue={class:"space-y-2"},de={class:"relative"},ie={key:0,class:"absolute z-50 mt-1 w-full rounded-md border bg-white shadow-lg"},ce=["onMousedown"],me={class:"font-medium"},pe={class:"text-muted-foreground text-xs"},ve={key:0,class:"text-sm text-destructive"},_e={key:1,class:"rounded-md bg-muted px-4 py-3 text-sm flex items-center justify-between"},fe={class:"font-medium"},xe={class:"text-muted-foreground ml-2"},ye={key:0,class:"ml-2 text-xs text-muted-foreground capitalize"},be={key:0,class:"space-y-2"},he={key:0,class:"text-sm text-muted-foreground"},ge={key:1,class:"space-y-2"},we=["value"],ke={class:"text-sm"},Ce={class:"font-medium"},Ve={class:"text-muted-foreground"},qe={key:0,class:"text-xs text-primary mt-0.5"},$e={class:"space-y-2"},je={class:"relative"},Me={key:0,class:"absolute z-50 mt-1 w-full rounded-md border bg-white shadow-lg"},Se=["onMousedown"],Fe={class:"text-muted-foreground text-xs ml-4"},Ne={key:0,class:"text-xs text-muted-foreground"},Be={key:1,class:"text-sm text-destructive"},Pe={key:1,class:"space-y-2"},Te={class:"flex-1 text-sm font-medium"},ze={class:"text-sm text-muted-foreground w-20 text-right"},Le={class:"flex items-center gap-1"},Ue=["onClick"],De=["onUpdate:modelValue"],Ae=["onClick"],Ie={class:"text-sm font-medium w-20 text-right"},Ee=["onClick"],Oe={class:"flex justify-end pt-2 border-t"},Re={class:"text-sm font-bold"},Ze={class:"space-y-2"},Ge={class:"flex gap-3 pt-2"},at=W({__name:"CreateOrder",props:{customers:{},products:{}},setup(D){const g=D,A=[{title:"Dashboard",href:"/dashboard"},{title:"Bestellingen",href:"/admin/orders"},{title:"Nieuwe bestelling"}],b=m(""),r=m(null),w=m(!1),N=F(()=>{const o=b.value.toLowerCase();return o?g.customers.filter(e=>e.company_name.toLowerCase().includes(o)||e.contact_person.toLowerCase().includes(o)).slice(0,10):g.customers.slice(0,10)}),I=o=>{r.value=o,b.value=o.company_name,w.value=!1;const e=o.delivery_addresses.find(t=>t.is_default)??o.delivery_addresses[0]??null;y.value=e?.id??null,i.value=i.value.map(t=>({...t,unit_price:M(t.product_id)}))},E=()=>{r.value=null,b.value="",y.value=null},y=m(null),k=m(""),C=m(!1),B=F(()=>{const o=k.value.toLowerCase();return o?g.products.filter(e=>e.title.toLowerCase().includes(o)).slice(0,8):[]}),M=o=>{const e=g.products.find(K=>K.id===o);if(!e||!r.value)return 0;const t=r.value.customer_category;let p=parseFloat(t==="broodjeszaak"?e.price_broodjeszaak:t==="horeca"?e.price_horeca:e.price_groothandel);const _=parseFloat(r.value.discount_percentage??"0");return _>0&&(p=p*(1-_/100)),Math.round(p*100)/100},i=m([]),O=o=>{const e=i.value.find(t=>t.product_id===o.id);e?e.quantity+=1:i.value.push({product_id:o.id,product_title:o.title,quantity:1,unit_price:M(o.id)}),k.value="",C.value=!1},R=o=>{i.value.splice(o,1)},Z=F(()=>i.value.reduce((o,e)=>o+e.unit_price*e.quantity,0)),V=o=>new Intl.NumberFormat("nl-NL",{style:"currency",currency:"EUR"}).format(o),S=m(""),v=m({}),q=m(!1),G=()=>{if(v.value={},!r.value){v.value.customer="Selecteer een klant.";return}if(i.value.length===0){v.value.items="Voeg minimaal één product toe.";return}q.value=!0,Y.post("/admin/orders",{customer_id:r.value.id,delivery_address_id:y.value,items:i.value.map(o=>({product_id:o.product_id,quantity:o.quantity})),notes:S.value||null},{onError:o=>{v.value=o,q.value=!1},onFinish:()=>{q.value=!1}})};return(o,e)=>(n(),l(h,null,[u(d(H),{title:"Nieuwe bestelling"}),u(oe,{breadcrumbs:A},{default:f(()=>[s("div",ne,[s("div",null,[s("h1",ae,[u(d(ee),{class:"h-6 w-6"}),e[8]||(e[8]=x(" Nieuwe bestelling ",-1))]),e[9]||(e[9]=s("p",{class:"text-sm text-muted-foreground"},"Maak een bestelling aan namens een klant",-1))]),s("div",re,[s("div",ue,[u(d(j),null,{default:f(()=>[...e[10]||(e[10]=[x("Klant ",-1),s("span",{class:"text-destructive"},"*",-1)])]),_:1}),s("div",de,[u(d(U),{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),u(d(L),{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=t=>b.value=t),placeholder:"Zoek op bedrijfsnaam of contactpersoon...",class:"pl-9",onFocus:e[1]||(e[1]=t=>w.value=!0),onBlur:e[2]||(e[2]=t=>o.setTimeout(()=>w.value=!1,150)),autocomplete:"off"},null,8,["modelValue"]),w.value&&N.value.length>0?(n(),l("div",ie,[(n(!0),l(h,null,$(N.value,t=>(n(),l("button",{key:t.id,type:"button",class:"w-full text-left px-4 py-2 text-sm hover:bg-muted flex flex-col",onMousedown:P(p=>I(t),["prevent"])},[s("span",me,a(t.company_name),1),s("span",pe,a(t.contact_person),1)],40,ce))),128))])):c("",!0)]),v.value.customer?(n(),l("p",ve,a(v.value.customer),1)):c("",!0),r.value?(n(),l("div",_e,[s("div",null,[s("span",fe,a(r.value.company_name),1),s("span",xe,a(r.value.contact_person),1),r.value.customer_category?(n(),l("span",ye,"("+a(r.value.customer_category)+")",1)):c("",!0)]),s("button",{type:"button",onClick:E,class:"text-muted-foreground hover:text-foreground text-xs"},"× Wissen")])):c("",!0)]),r.value?(n(),l("div",be,[u(d(j),null,{default:f(()=>[...e[11]||(e[11]=[x("Afleveradres",-1)])]),_:1}),r.value.delivery_addresses.length===0?(n(),l("div",he," Geen afleveradressen — hoofdadres wordt gebruikt ")):(n(),l("div",ge,[(n(!0),l(h,null,$(r.value.delivery_addresses,t=>(n(),l("label",{key:t.id,class:J(["flex items-start gap-3 rounded-md border p-3 cursor-pointer",y.value===t.id?"border-primary bg-primary/5":""])},[T(s("input",{type:"radio",value:t.id,"onUpdate:modelValue":e[3]||(e[3]=p=>y.value=p),class:"mt-0.5"},null,8,we),[[Q,y.value]]),s("div",ke,[s("div",Ce,a(t.name),1),s("div",Ve,a(t.street_name)+" "+a(t.house_number)+", "+a(t.postal_code)+" "+a(t.city),1),t.is_default?(n(),l("div",qe,"Standaard")):c("",!0)])],2))),128))]))])):c("",!0),s("div",$e,[u(d(j),null,{default:f(()=>[...e[12]||(e[12]=[x("Producten ",-1),s("span",{class:"text-destructive"},"*",-1)])]),_:1}),s("div",je,[u(d(U),{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),u(d(L),{modelValue:k.value,"onUpdate:modelValue":e[4]||(e[4]=t=>k.value=t),placeholder:"Zoek product op naam...",class:"pl-9",onFocus:e[5]||(e[5]=t=>C.value=!0),onBlur:e[6]||(e[6]=t=>o.setTimeout(()=>C.value=!1,150)),autocomplete:"off",disabled:!r.value},null,8,["modelValue","disabled"]),C.value&&B.value.length>0?(n(),l("div",Me,[(n(!0),l(h,null,$(B.value,t=>(n(),l("button",{key:t.id,type:"button",class:"w-full text-left px-4 py-2 text-sm hover:bg-muted flex justify-between items-center",onMousedown:P(p=>O(t),["prevent"])},[s("span",null,a(t.title),1),s("span",Fe,a(V(M(t.id))),1)],40,Se))),128))])):c("",!0)]),r.value?c("",!0):(n(),l("p",Ne,"Selecteer eerst een klant om de juiste prijzen te berekenen.")),v.value.items?(n(),l("p",Be,a(v.value.items),1)):c("",!0)]),i.value.length>0?(n(),l("div",Pe,[(n(!0),l(h,null,$(i.value,(t,p)=>(n(),l("div",{key:t.product_id,class:"flex items-center gap-3 rounded-md border px-3 py-2"},[s("div",Te,a(t.product_title),1),s("div",ze,a(V(t.unit_price)),1),s("div",Le,[s("button",{type:"button",class:"h-6 w-6 rounded border text-sm flex items-center justify-center hover:bg-muted",onClick:_=>t.quantity=Math.max(1,t.quantity-1)},"−",8,Ue),T(s("input",{type:"number","onUpdate:modelValue":_=>t.quantity=_,min:"1",class:"w-12 text-center text-sm border rounded px-1 py-0.5"},null,8,De),[[X,t.quantity,void 0,{number:!0}]]),s("button",{type:"button",class:"h-6 w-6 rounded border text-sm flex items-center justify-center hover:bg-muted",onClick:_=>t.quantity+=1},"+",8,Ae)]),s("div",Ie,a(V(t.unit_price*t.quantity)),1),s("button",{type:"button",onClick:_=>R(p),class:"text-destructive hover:opacity-70 ml-1"},[u(d(te),{class:"h-4 w-4"})],8,Ee)]))),128)),s("div",Oe,[s("span",Re,"Totaal: "+a(V(Z.value)),1)])])):c("",!0),s("div",Ze,[u(d(j),{for:"notes"},{default:f(()=>[...e[13]||(e[13]=[x("Bestelnotitie",-1)])]),_:1}),u(d(le),{id:"notes",modelValue:S.value,"onUpdate:modelValue":e[7]||(e[7]=t=>S.value=t),placeholder:"Optionele opmerkingen bij de bestelling...",rows:"3"},null,8,["modelValue"])]),s("div",Ge,[u(d(z),{onClick:G,disabled:q.value},{default:f(()=>[u(d(se),{class:"h-4 w-4 mr-2"}),e[14]||(e[14]=x(" Bestelling aanmaken ",-1))]),_:1},8,["disabled"]),u(d(z),{variant:"outline",as:"a",href:"/admin/orders"},{default:f(()=>[...e[15]||(e[15]=[x("Annuleren",-1)])]),_:1})])])])]),_:1})],64))}});export{at as default};
